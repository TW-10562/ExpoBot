# タスクスケジューリングドキュメント

## 0. 事前準備

ジョブワーカーを起動します：

```bash
pnpm worker
```

## 1. ジョブログックの作成

ファイル [worker.ts](../api/src/queue/worker.ts) に処理ロジックを追加します。例：

```ts
// say hello job
jobQueue.process('sayHelloJob', async (job) => {
  console.log(`[${dayjs().format('YYYY-MM-DD HH:mm:ss')}] Hello, ${job.data.name}!`);
  // TODO: 実際のロジックを実装
});
```

## 2. 定期ジョブの登録

ファイル [repeatJobs.ts](../api/src/scheduler/repeatJobs.ts) に定期ジョブを追加します。例：

```ts
// 5秒ごとにHelloを出力
await addJob(
  'sayHelloJob',
  { name: 'Aviary' },
  {
    repeat: { cron: '*/5 * * * * *' },
  },
);
```

## 3. よく使われる Cron パターン

| 式                    | 意味           | 説明              |
| :------------------- | :----------- | :-------------- |
| `* * * * * *`        | 毎秒実行         | テスト用（本番環境では非推奨） |
| `*/5 * * * * *`      | 5秒ごとに実行      | 短周期タスク          |
| `0 * * * * *`        | 毎分0秒に実行      | 毎分タスク           |
| `0 */5 * * * *`      | 5分ごとに実行      | 定期チェックタスク       |
| `0 0 * * * *`        | 毎時実行         | 毎時タスク           |
| `0 0 */6 * * *`      | 6時間ごとに実行     | 日中複数回実行タスク      |
| `0 0 0 * * *`        | 毎日0時に実行      | 日次集計やクリーンアップ    |
| `0 0 8 * * *`        | 毎日8時に実行      | 朝のレポートや通知       |
| `0 0 12 * * MON-FRI` | 月曜〜金曜の12時に実行 | 平日タスク           |
| `0 0 9 1 * *`        | 毎月1日の9時に実行   | 月次レポート生成        |
| `0 0 9 1 JAN *`      | 毎年1月1日の9時に実行 | 年次アーカイブタスク      |

> **Cron フォーマット（6項目）**
>
> ```
> 秒 分 時 日 月 曜日
> ```
>
> 例：`0 30 9 * * *` → 毎日9:30に実行。

## 4. デバッグとモニタリング

可視化ダッシュボードでジョブの状態を確認できます：
[Bull Board](http://localhost:9999)

実行ログは、ワーカーのコンソール上でもリアルタイムで確認可能です。
