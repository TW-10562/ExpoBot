%% CONFIGURATION & ENV FLOW
flowchart LR
  ConfigFile["config/default.yml<br/>config/example.yml"]
  ConfigSchema["config/schema.ts<br/>Zod schema validation"]
  ConfigLoader["config/index.ts<br/>loadConfig"]
  RuntimeEnv["Environment Variables<br/>process.env<br/>OLLAMA_API OLLAMA_MODEL<br/>MYSQL_HOST REDIS_URL JWT"]

  subgraph AppConsumers["Services consuming config"]
    LLMService["services/llmService.ts<br/>config.Ollama.url<br/>config.Ollama.model<br/>config.Models.chatModel"]
    TranslationUtil["utils/translation.ts<br/>config.Models.chatModel.name<br/>config.Ollama.model"]
    RAGServiceConfig["services/ragService.ts<br/>config.RAG.Backend<br/>config.RAG.VectorStore<br/>config.RAG.Retrieval"]
    MySQLDB["mysql/db/index.ts<br/>config.MySQL"]
    RedisClient["clients/redis.ts<br/>config.Redis.host<br/>config.Redis.port"]
    SolrService["services/solrService.ts<br/>config.ApacheSolr.url"]
  end

  subgraph Propagation["Config propagation"]
    InitApp["api/src/main.ts<br/>imports config"]
    Service["All services import<br/>from @config/index"]
  end

  ConfigFile --> ConfigLoader
  ConfigSchema --> ConfigLoader
  RuntimeEnv --> ConfigLoader
  ConfigLoader --> InitApp
  InitApp --> Service
  Service --> AppConsumers

  subgraph Secrets["Secrets & Sensitive"]
    JWTSecret["jwtSecret<br/>jwtRefreshSecret<br/>from config/default.yml or env"]
    DBPassword["MySQL password<br/>from config/default.yml"]
    RedisPassword["Redis password<br/>from config/default.yml"]
  end

  ConfigLoader --> Secrets
  Secrets --> MySQLDB
  Secrets --> RedisClient

  subgraph Example["Example flow"]
    Ex1["config/default.yml has<br/>Ollama.url: http://localhost:11435<br/>Ollama.model: gpt-oss:20b"]
    Ex2["ConfigLoader reads YAML<br/>validates with schema"]
    Ex3["llmService imports config<br/>uses config.Ollama.model<br/>calls Ollama API"]
  end

  Ex1 --> Ex2 --> Ex3
